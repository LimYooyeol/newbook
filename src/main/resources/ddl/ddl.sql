#CREATE DATABASE IF NOT EXISTS glolearn_dev DEFAULT CHARACTER SET UTF8MB4;

use glolearn_dev;

DROP TABLE IF EXISTS ENROLLMENT;
DROP TABLE IF EXISTS LECTURE;
DROP TABLE IF EXISTS COURSE;
DROP TABLE IF EXISTS AUTH_INFO;
DROP TABLE IF EXISTS MEMBERS;


CREATE TABLE MEMBERS(
	member_id		BIGINT			PRIMARY KEY AUTO_INCREMENT,
    oauth_id		VARCHAR(255)	NOT NULL,
    oauth_domain	VARCHAR(255)	NOT NULL,
    nickname		VARCHAR(50)		NOT NULL UNIQUE
);
CREATE TABLE AUTH_INFO(
	token_id		char(36)		PRIMARY KEY,
    member_id		BIGINT			NOT NULL,
    expire_date		DATETIME		NOT NULL,
    FOREIGN KEY	(member_id)	REFERENCES MEMBERS(member_id) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE COURSE(
	course_id			BIGINT			PRIMARY KEY AUTO_INCREMENT,
    lecturer			BIGINT			NOT NULL,
    title				VARCHAR(100)	NOT NULL,
    reg_date			DATETIME		NOT NULL DEFAULT CURRENT_TIMESTAMP,
    introduction		VARCHAR(10000)	NOT NULL DEFAULT '', 
    is_published		BOOLEAN			NOT NULL DEFAULT FALSE,
	category			VARCHAR(100)	NOT NULL,
    cover				VARCHAR(255)	NOT NULL,
    num_student			BIGINT			NOT NULL DEFAULT 0,
    FOREIGN KEY	(lecturer) REFERENCES members(member_id)	ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE LECTURE(
	lecture_id			BIGINT			PRIMARY KEY AUTO_INCREMENT,
    course_id			BIGINT			NOT NULL,
    lecturer			BIGINT			NOT NULL,
    title				VARCHAR(100)	NOT NULL,
    reg_date			DATETIME		NOT NULL DEFAULT CURRENT_TIMESTAMP,
    last_update_date	DATETIME		NOT NULL DEFAULT CURRENT_TIMESTAMP,
    contents			VARCHAR(10000),  
    FOREIGN KEY	(course_id) REFERENCES COURSE(course_id)	ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY	(lecturer) REFERENCES MEMBERS(member_id)	ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE ENROLLMENT(
	enrollment_id		BIGINT		PRIMARY KEY AUTO_INCREMENT,
	member_id			BIGINT		NOT NULL,
    course_id			BIGINT		NOT NULL,
    FOREIGN KEY	(member_id)	REFERENCES MEMBERS(member_id)	ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (course_id) REFERENCES COURSE(course_id)	ON UPDATE CASCADE ON DELETE CASCADE,
    UNIQUE (member_id, course_id)
);




